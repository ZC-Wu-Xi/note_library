---
author: 汐
mail: 1302344595@qq.com
---

## MySQL 基本语法

### 一、数据库操作

```sql
# 创建数据库  
create database 数据库名字; # 创建数据库  

# 查看已有数据库  
show databases; # 显示所有数据库  

# 选择使用的数据库  
use 数据库名字; # 选择当前操作的数据库  

# 删除数据库  
drop database if exists 数据库名字; # 删除指定数据库  
```

### 二、表管理

**数据类型**：选择合理的数据类型可以提高性能。常见的数据类型包括：

- `int`, `bigint`, `float`, `double` 等数值类型；
- `varchar`, `char`, `text` 等字符类型；
- `date`, `datetime`, `timestamp` 等日期时间类型。

**约束条件**：可使用 `not null`, `unique`, `primary key`, `foreign key` 来增强数据的完整性和一致性。

```sql
# 创建表  
create table if not exists 表名 (  
    列名1 数据类型(长度) 约束,  
    列名2 数据类型(长度) 约束,  
    ...  
);  

# 删除表  
drop table if exists 表名; # 删除指定表  

# 修改表结构：增加列  
alter table 表名 add 列名 数据类型(长度) 约束;  

# 修改表结构：删除列  
alter table 表名 drop column 列名;  

# 修改表结构：修改列  
alter table 表名 modify 列名 新数据类型(新长度);  

# 修改表名  
alter table 表名 change 列名 新列名 数据类型(长度);  
```

### 三、插入数据

```sql
# 插入数据  
insert into 表名 values ('值1', '值2', ...); # 值的个数需与列数匹配  
insert into 表名 (列名1, 列名2) values ('值1', '值2'); # 指定列用于插入数据  

# 插入多行数据  
insert into 表名 (列名1, 列名2) values ('值1', '值2'), ('值3', '值4');  
```

### 四、修改数据

```sql
# 更新全部数据  
update 表名 set 列名 = 新值;  

# 条件更新  
update 表名 set 列名 = 新值 where 条件; # 支持模糊匹配，如 where 列名 like '%值%';  
```

### 五、查询数据

对于以下 SQL 语句：

```sql
SELECT 列名1, COUNT(*) AS 计数  
FROM 表名
WHERE 列名2 = '某值'  
GROUP BY 列名1  
HAVING 计数 > 1  
ORDER BY 列名1  
LIMIT 10;  
```

执行顺序如下：

1. **FROM 表名**
2. **WHERE 列名2 = '某值'**（过滤条件）
3. **GROUP BY 列名1**（分组操作）
4. **HAVING 计数 > 1**（对分组结果进行条件过滤）
5. **SELECT 列名1, COUNT(\*)**
6. **ORDER BY 列名1**（结果排序）
7. **LIMIT 10**（限制返回结果的行数）

```sql
select * from 表名;  # 查询所有列数据  
select 列名1 as 别名, 列名2 from 表名;  # 查询特定列 使用别名 
select distinct 列名 from 表名;  # 去重

select 列名, count(*) from 表名 group by 列名 having count(*) > 1;  # 分组查询 having 用于条件过滤分组结果  

# 排序查询
select * from 表名 order by 列名;  -- 默认升序  
select * from 表名 order by 列名 desc;  -- 降序  

# 分页查询  
select * from 表名 limit n offset m;  -- offset 默认为 0；可用于跳过前 m 行。  
select * from 表名 limit m, n;  -- 这种方式表示查询 m 到 m+n 行数据。  

# 带条件的查询  
select * from 表名 where 条件;  -- 通过 where 语句过滤数据记录  
select * from 表名 where 列名 like '%关键字%';  -- 模糊查询，可以使用通配符来匹配  
# 查询并结合多条条件  
select * from 表名 where 条件1 and 条件2;  -- 使用 and 连接多个条件  
select * from 表名 where 条件1 or 条件2;  -- 使用 or 连接多个条件  

# 聚合函数的查询  
select avg(列名) as 平均值, sum(列名) as 总和 from 表名;  -- 使用聚合函数 查询平均值和总和 
```

### 六、多表查询

```sql
# 内连接  
select * from 表名1 inner join 表名2 on 表名1.列名 = 表名2.列名; # 查询两表匹配数据  

# 左外连接  
select * from 表名1 left join 表名2 on 表名1.列名 = 表名2.列名; # 查询左表所有数据及右表匹配数据  

# 右外连接  
select * from 表名1 right join 表名2 on 表名1.列名 = 表名2.列名; # 查询右表所有数据及左表匹配数据  

# 全外连接  
select * from 表名1 left join 表名2 on 表名1.列名 = 表名2.列名  
union  
select * from 表名1 right join 表名2 on 表名1.列名 = 表名2.列名; # 当 mysql 版本支持时  

# 笛卡尔积查询  
select * from 表名1 cross join 表名2;  
```

### 七、存储过程

```sql
# 删除存储过程  
drop procedure if exists 存储过程名;  

# 设置分隔符  
delimiter $$  

# 创建存储过程  
create procedure 存储过程名(
   [in 输入参数名 数据类型,          # 输入参数，调用时传入的值  
    out 输出参数名 数据类型,         # 输出参数，调用后可获得的值  
    inout 进出参数名 数据类型]       # 进出参数，调用前后均可访问的值  
)  
begin  
    -- 过程体：可包含变量的定义和 sql 操作  
    declare 变量名 数据类型;           # 定义局部变量  
    set 变量名 = 初始值;                 # 初始化变量  

    -- 逻辑处理，例如计算、条件语句等  
    if 输入参数名 > 0 then  
        set 变量名 = 输入参数名 * 2;    -- 处理逻辑示例  
    else  
        set 变量名 = 1;                 -- 处理逻辑示例  
    end if;  

    set 输出参数名 = 变量名;            # 将计算结果赋值到输出参数  
end $$  

# 恢复分隔符  
delimiter ;  

# 调用存储过程  
call 存储过程名([输入值, @输出值, @进出值]);  

# 获取输出参数的值  
select @输出值; # 查询输出参数的值    
```

### 八、视图

视图可以简化复杂查询，但某些更新操作可能无法反映到基础表上。

```sql
# 创建视图  
create view 视图名 as  
select 列名1, 列名2 from 表名 where 条件;  

# 查询视图  
select * from 视图名;  

# 更新视图（需注意，更新视图仅限于某些情况下）  
update 视图名 set 列名 = 新值 where 条件;  

# 删除视图  
drop view if exists 视图名;  
```

### 九、索引

**索引策略**：

- 使用索引可以加速查询操作，但过多的索引会增加写入操作的开销。
- 常用的索引类型包括普通索引、唯一索引和全文索引。

```sql
# 创建索引  
create index 索引名 on 表名(列名); # 创建普通索引  

# 创建唯一索引  
create unique index 索引名 on 表名(列名); # 创建唯一索引  

# 创建复合索引  
create index 索引名 on 表名(列名1, 列名2); # 根据多个列创建索引  

# 查看索引  
show index from 表名; # 显示表中的所有索引  

# 删除索引  
drop index 索引名 on 表名; # 删除指定索引  
```

### 十、函数

```sql
# 创建用户自定义函数  
delimiter $$  

create function 函数名 (参数 数据类型) returns 返回数据类型  
begin  
    -- 函数体  
    return 返回值;   
end $$  

delimiter ;  

# 调用自定义函数  
select 函数名(参数);  
```

## 常用函数

### 一、字符串操作类

| 函数名                           | 作用                   | 示例                                 |
| :------------------------------- | :--------------------- | :----------------------------------- |
| `LENGTH(str)`                    | 返回字符串**字节长度** | `SELECT LENGTH('abc');`              |
| `CHAR_LENGTH(str)`               | 返回字符串**字符长度** | `SELECT CHAR_LENGTH('abc');`         |
| `LOWER(str)`                     | 转换为**小写**         | `SELECT LOWER('ABC');`               |
| `UPPER(str)`                     | 转换为**大写**         | `SELECT UPPER('abc');`               |
| `CONCAT(str1, ...)`              | **连接多个字符串**     | `SELECT CONCAT('a', 'b');`           |
| `SUBSTRING(str, start, length)`  | 返回**子字符串**       | `SELECT SUBSTRING('hello', 1, 3);`   |
| `REPLACE(str, old_str, new_str)` | **替换字符串**         | `SELECT REPLACE('hello', 'e', 'a');` |
| `TRIM(str)`                      | 去除**两端空格**       | `SELECT TRIM(' abc ');`              |

### 二、日期和时间类

| 函数名                               | 作用                     | 示例                                              |
| :----------------------------------- | :----------------------- | :------------------------------------------------ |
| `NOW()`                              | 返回当前**日期和时间**   | `SELECT NOW();`                                   |
| `CURDATE()`                          | 返回当前**日期**         | `SELECT CURDATE();`                               |
| `CURTIME()`                          | 返回当前**时间**         | `SELECT CURTIME();`                               |
| `DATE_ADD(date, INTERVAL expr unit)` | **添加时间间隔**         | `SELECT DATE_ADD('2025-01-01', INTERVAL 10 DAY);` |
| `DATEDIFF(date1, date2)`             | 返回两个日期间的**天数** | `SELECT DATEDIFF('2025-01-01', '2024-12-25');`    |
| `EXTRACT(unit FROM date)`            | **提取日期部分**         | `SELECT EXTRACT(YEAR FROM NOW());`                |

### 三、数学类

| 函数名        | 作用                        | 示例                        |
| :------------ | :-------------------------- | :-------------------------- |
| `ABS(x)`      | 返回**绝对值**              | `SELECT ABS(-5);`           |
| `ROUND(x, d)` | **四舍五入**到小数点后 d 位 | `SELECT ROUND(3.14159, 2);` |
| `FLOOR(x)`    | 返回不大于 x 的**最大整数** | `SELECT FLOOR(3.7);`        |
| `CEIL(x)`     | 返回不小于 x 的**最小整数** | `SELECT CEIL(3.1);`         |
| `RAND()`      | 返回**随机数**              | `SELECT RAND();`            |

### 四、聚合类

| 函数名              | 作用                           | 示例                              |
| :------------------ | :----------------------------- | :-------------------------------- |
| `COUNT(expression)` | 计数行数或非 NULL 值的**数量** | `SELECT COUNT(*) FROM 表名;`      |
| `SUM(column)`       | 返回某列的**总和**             | `SELECT SUM(金额) FROM 订单表;`   |
| `AVG(column)`       | 返回某列的**平均值**           | `SELECT AVG(成绩) FROM 学生成绩;` |
| `MIN(column)`       | 返回某列的**最小值**           | `SELECT MIN(价格) FROM 商品表;`   |
| `MAX(column)`       | 返回某列的**最大值**           | `SELECT MAX(成绩) FROM 学生成绩;  |

## 数据类型

精简表格：

| 数据类型       | 大小             | 用途                     | 备注                       |
| :------------- | :--------------- | :----------------------- | :------------------------- |
| `tinyint`      | 1 字节           | 状态码、是否标志         | 占用空间小，适合小范围计数 |
| `smallint`     | 2 字节           | 中小范围整数             | 可存储较大数值             |
| `int`          | 4 字节           | 用户ID、主键             | 最常用的整数类型           |
| `bigint`       | 8 字节           | 极大整数值               | 支持大范围整数             |
| `float`        | 4 字节           | 小数、科学计算           | 精度低，存储效率高         |
| `double`       | 8 字节           | 大范围小数               | 高精度，适合要求严格的计算 |
| `decimal(p,s)` | 可变长度         | 财务、货币计算           | 精度高，适合高价值场景     |
| `varchar(n)`   | 可变长度         | 变长字符串，如姓名、地址 | 灵活，适合变化较大的数据   |
| `text`         | 最大 65,535 字符 | 大段文本                 | 存储大文本，但处理效率较低 |
| `date`         | 3 字节           | 日期信息                 | 紧凑，便于日期相关操作     |
| `datetime`     | 8 字节           | 日期和时间信息           | 详细存储时间信息           |
| `enum`         | 1 到 2 字节      | 受限值的字符串           | 存储效率高，查询速度快     |
| `set`          | 1 到 8 字节      | 可选值的集合             | 存储多个选项，慎用高频更新 |

### 一、数值类型

---

`tinyint`：

- **存储空间：** 1 字节（8 位）。
- **取值范围：** 0 到 255（无符号）或 -128 到 127（有符号）。
- 使用场景：
  - **状态码**（如 0 表示禁用，1 表示启用）
  - **是否标志**（如 0 代表否，1 代表是）
  - **计数**（如小范围的计数，总数不超过 255 或 -128 到 127）
- **性能：** 性能好，占用空间较小，**大量记录**时，会显著降低存储需求。

------

`smallint`：

- **存储空间：** 2 字节（16 位）。
- **取值范围：** 0 到 65,535（无符号）或 -32,768 到 32,767（有符号）。
- 使用场景：
  - **中小范围的整数值**，例如人口统计或电话区号。
- **性能：** 相比于 tinyint，占用空间稍大，但可以存储更大的值。

------

`mediumint`：

- **存储空间：** 3 字节（24 位）。
- **取值范围：** 0 到 16,777,215（无符号）或 -8,388,608 到 8,388,607（有符号）。
- 使用场景：
  - **较大范围的计数**，例如库存数量。
- **性能：** 提供更大的范围，适合中等大小的整数。

------

`int` 或 `integer`：

- **存储空间：** 4 字节（32 位）。
- **取值范围：** 0 到 4,294,967,295（无符号）或 -2,147,483,648 到 2,147,483,647（有符号）。
- 使用场景：
  - **存储常用的整数**，例如用户ID或主键。
- **性能：** 常用的整数类型，在大多数情况下非常高效。

------

`bigint`：

- **存储空间：** 8 字节（64 位）。
- **取值范围：** 0 到 18,446,744,073,709,551,615（无符号）或 -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807（有符号）。
- 使用场景：
  - 需要存储**极大整数值**的场景，例如大数据分析。
- **性能：** 较大占用空间，但对于极大的范围提供了支持。

------

`float`：

- **存储空间：** 4 字节。
- **取值范围：** 大约 -3.402823466E+38 到 3.402823466E+38。
- 使用场景：
  - 存储**小数**，进行科学计算或涉及小数点的数值。
- **性能：** 占用较少空间，适合对**精度要求不高**的场合。

------

`double`：

- **存储空间：** 8 字节。
- **取值范围：** 大约 -1.7976931348623157E+308 到 1.7976931348623157E+308。
- 使用场景：
  - 存储**大范围的小数**，要求更高精度的科学计算。
- **性能：** 精度比 float 高，占用空间更大。

------

`decimal(p, s)`：

- **存储空间：** 存储**精确的数值**，复杂度与精度有关。
- **取值范围：** 范围根据 p（总位数）和 s（小数位数）而定，最多支持 65 位。
- 使用场景：
  - **财务和货币计算**，要求精确的小数计算。
- **性能：** 尽管占用空间较大，但提供了理想的**精度**，最适合高价值场景。

---

### 二、字符串类型

---

`char(n)`：

- **存储空间：** 固定长度，最长 255 字符。
- 使用场景：
  - 存储**定长字符串**，例如国家代码、电话号码等。
- **性能：** 固定长度，提高了访问效率，但可能**浪费空间**。

------

`varchar(n)`：

- **存储空间：** 可变长度，最多 65,535 字符（依赖于行的总大小）。
- 使用场景：
  - 存储**变长字符串**，例如姓名、地址等。
- **性能：** 更灵活，适合变化较大的数据，但需考虑变长带来的额外**存储开销**。

------

`text`：

- **存储空间：** 可存储最多 65,535 字符的文本。
- 使用场景：
  - 存储大段**文本**，例如评论、文章内容等。
- **性能：** 适合**大文本存储**，但处理效率可能低于 varchar。

------

`blob`：

- **存储空间：** 二进制大对象，最多支持 65,535 字节。
- 使用场景：
  - 存储**图像、音频文件**等二进制数据。
- **性能：** 使用时不适合进行字符串操作，但适合存储**大二进制数据**。

### 三、日期和时间类型

---

`date`：

- **存储空间：** 3 字节。
- 使用场景：
  - 存储**日期**（格式：YYYY-MM-DD），例如生日、开始日期等。
- **性能：** 紧凑存储，便于**日期相关操作**。

------

`time`：

- **存储空间：** 3 字节。
- 使用场景：
  - 存储**时间**（格式：HH:MM:SS），例如事件发生的时刻。
- **性能：** 适合处理**时间相关的数据**。

------

`datetime`：

- **存储空间：** 8 字节。
- 使用场景：
  - 存储**日期和时间**（格式：YYYY-MM-DD HH:MM:SS），例如创建和更新时间。
- **性能：** 适合需要存储详细时间信息的场景。

------

`timestamp`：

- **存储空间：** 4 字节。
- 使用场景：
  - 存储**时间戳**，能够自动更新（格式：YYYY-MM-DD HH:MM:SS），方便记录事件发生的时间。
- **性能：** 对于需要自动更新的时间信息，适合用于数据库的**时间审计**。

------

`year`：

- **存储空间：** 1 字节。
- 使用场景：
  - 存储**年份**（格式：YYYY），例如年份字段。
- **性能：** 存储占用小，简单且**高效**。

------

### 四、其他类型

---

`enum`：

- **存储空间：** 1 到 2 字节，根据取值数量。
- 使用场景：
  - 定义一个字符串列，允许的**取值有限**，例如性别（'male', 'female'）。
- **性能：** 存储效率高，查询速度快。

------

`set`：

- **存储空间：** 1 到 8 字节，根据允许的项数。
- 使用场景：
  - 定义多个值的**集合**，例如兴趣爱好，可以选择多个。
- **性能：** 适合存储**多个选项值**，但需谨慎使用，尤其是在高频**更新**时。
